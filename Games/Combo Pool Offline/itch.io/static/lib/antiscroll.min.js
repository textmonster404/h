(function(b){function h(a,e){this.el=b(a);this.options=e||{};this.x=!1!==this.options.x||this.options.forceHorizontal;this.y=!1!==this.options.y||this.options.forceVertical;this.autoHide=!1!==this.options.autoHide;this.padding=void 0==this.options.padding?2:this.options.padding;this.inner=this.el.find(".antiscroll-inner");this.inner.css({width:"+="+(this.y?k():0),height:"+="+(this.x?k():0)});this.refresh()}function c(a){this.pane=a;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);
this.shown=this.enter=this.dragging=!1;this.pane.el.mouseenter(b.proxy(this,"mouseenter"));this.pane.el.mouseleave(b.proxy(this,"mouseleave"));this.el.mousedown(b.proxy(this,"mousedown"));this.innerPaneScrollListener=b.proxy(this,"scroll");this.pane.inner.scroll(this.innerPaneScrollListener);this.innerPaneMouseWheelListener=b.proxy(this,"mousewheel");this.pane.inner.bind("mousewheel",this.innerPaneMouseWheelListener);a=this.pane.options.initialDisplay;!1!==a&&(this.show(),this.pane.autoHide&&(this.hiding=
setTimeout(b.proxy(this,"hide"),parseInt(a,10)||3E3)))}function m(a,e){function d(){}d.prototype=e.prototype;a.prototype=new d}function k(){if(void 0===l){var a=b('<div class="antiscroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');b("body").append(a);var e=b(a).innerWidth(),d=b("div",a).innerWidth();b(a).remove();l=e-d}return l}b.fn.antiscroll=function(a){return this.each(function(){b(this).data("antiscroll")&&
b(this).data("antiscroll").destroy();b(this).data("antiscroll",new b.Antiscroll(this,a))})};b.Antiscroll=h;h.prototype.refresh=function(){var a=this.inner.get(0).scrollWidth>this.el.width()+(this.y?k():0),e=this.inner.get(0).scrollHeight>this.el.height()+(this.x?k():0);this.x&&(!this.horizontal&&a?this.horizontal=new c.Horizontal(this):this.horizontal&&!a?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update());this.y&&(!this.vertical&&e?this.vertical=new c.Vertical(this):
this.vertical&&!e?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())};h.prototype.destroy=function(){this.horizontal&&(this.horizontal.destroy(),this.horizontal=null);this.vertical&&(this.vertical.destroy(),this.vertical=null);return this};h.prototype.rebuild=function(){this.destroy();this.inner.attr("style","");h.call(this,this.el,this.options);return this};c.prototype.destroy=function(){this.el.remove();this.pane.inner.unbind("scroll",this.innerPaneScrollListener);
this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener);return this};c.prototype.mouseenter=function(){this.enter=!0;this.show()};c.prototype.mouseleave=function(){this.enter=!1;this.dragging||this.pane.autoHide&&this.hide()};c.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||!this.pane.autoHide||(this.hiding=setTimeout(b.proxy(this,"hide"),1500)));this.update()};c.prototype.mousedown=function(a){a.preventDefault();this.dragging=!0;this.startPageY=a.pageY-
parseInt(this.el.css("top"),10);this.startPageX=a.pageX-parseInt(this.el.css("left"),10);this.el[0].ownerDocument.onselectstart=function(){return!1};var e=b.proxy(this,"mousemove"),d=this;b(this.el[0].ownerDocument).mousemove(e).mouseup(function(){d.dragging=!1;this.onselectstart=null;b(this).unbind("mousemove",e);d.enter||d.hide()})};c.prototype.show=function(a){!this.shown&&this.update()&&(this.el.addClass("antiscroll-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=
!0)};c.prototype.hide=function(){!1!==this.pane.autoHide&&this.shown&&(this.el.removeClass("antiscroll-scrollbar-shown"),this.shown=!1)};c.Horizontal=function(a){this.el=b('<div class="antiscroll-scrollbar antiscroll-scrollbar-horizontal">',a.el);c.call(this,a)};m(c.Horizontal,c);c.Horizontal.prototype.update=function(){var a=this.pane.el.width(),e=a-2*this.pane.padding,d=this.pane.inner.get(0);this.el.css("width",e*a/d.scrollWidth).css("left",e*d.scrollLeft/d.scrollWidth);return a<d.scrollWidth};
c.Horizontal.prototype.mousemove=function(a){var e=this.pane.el.width()-2*this.pane.padding,d=a.pageX-this.startPageX;a=this.el.width();var b=this.pane.inner.get(0),d=Math.min(Math.max(d,0),e-a);b.scrollLeft=(b.scrollWidth-this.pane.el.width())*d/(e-a)};c.Horizontal.prototype.mousewheel=function(a,b,d,c){if(0>d&&0==this.pane.inner.get(0).scrollLeft||0<d&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return a.preventDefault(),!1};c.Vertical=function(a){this.el=b('<div class="antiscroll-scrollbar antiscroll-scrollbar-vertical">',
a.el);c.call(this,a)};m(c.Vertical,c);c.Vertical.prototype.update=function(){var a=this.pane.el.height(),b=a-2*this.pane.padding,d=this.innerEl,c=b*a/d.scrollHeight,c=20>c?20:c,f=b*d.scrollTop/d.scrollHeight;f+c>b&&(f=f-(f+c-b)-3);this.el.css("height",c).css("top",f);return a<d.scrollHeight};c.Vertical.prototype.mousemove=function(a){var b=this.pane.el.height(),c=b-2*this.pane.padding,g=a.pageY-this.startPageY;a=this.el.height();var f=this.innerEl,g=Math.min(Math.max(g,0),c-a);f.scrollTop=(f.scrollHeight-
b)*g/(c-a)};c.Vertical.prototype.mousewheel=function(a,b,c,g){if(0<g&&0==this.innerEl.scrollTop||0>g&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return a.preventDefault(),!1};var l})(jQuery);
